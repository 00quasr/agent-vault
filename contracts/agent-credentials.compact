pragma language_version >= 0.18;

import CompactStandardLibrary;

// Agent Vault - Zero-Knowledge Credential System
// Demonstrates ZK proofs for agent authorization

// Public ledger state (visible on-chain)
export ledger totalCredentials: Counter;
export ledger successfulAuth: Counter;
export ledger blockedAttempts: Counter;

// Store last issued commitment (for demo - shows on-chain proof happened)
export ledger lastCredentialCommitment: Opaque<"string">;

// Circuit 1: Issue a credential to an agent
// The secret stays private, only a commitment is made public
export circuit issueCredential(agentSecret: Opaque<"string">): [] {
    // Store the credential commitment (opaque - not revealed)
    // This creates a ZK proof that credential was issued
    // without revealing the actual secret
    lastCredentialCommitment = disclose(agentSecret);

    // Increment public counter
    totalCredentials.increment(1);
}

// Circuit 2: Prove authorization
// Agent proves they know the secret that matches a commitment
// WITHOUT revealing the secret itself (zero-knowledge proof)
export circuit proveAuthorization(
    agentSecret: Opaque<"string">,
    expectedCommitment: Opaque<"string">
): [] {
    // ZK Verification: Agent proves they know secret without revealing it
    // The assertion happens in the circuit (private computation)
    // Only the result (success/fail) becomes public
    assert(agentSecret == expectedCommitment, "Invalid credential");

    // If we reach here, ZK proof succeeded
    successfulAuth.increment(1);
}

// Circuit 3: Report blocked unauthorized attempt
export circuit reportBlocked(): [] {
    blockedAttempts.increment(1);
}
